@model ERP.BLL.DTOs.WeeklyDigestData
@{
    ViewData["Title"] = "Weekly Executive Digest";
}

<div class="container-fluid px-4 py-3">
    <h3><i class="fas fa-file-alt text-primary"></i> Weekly Executive Digest</h3>
    <p class="text-muted">Period: @Model.PeriodStart.ToString("MMM dd") – @Model.PeriodEnd.ToString("MMM dd, yyyy") &nbsp;|&nbsp; Generated: @Model.GeneratedAt.ToString("yyyy-MM-dd HH:mm") UTC</p>

    <!-- Summary Stats -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-lg-2">
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold">@Model.TotalActiveTasks</div>
                <small class="text-muted">Active Tasks</small>
            </div>
        </div>
        <div class="col-6 col-lg-2">
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold text-success">@Model.TasksCompletedThisWeek</div>
                <small class="text-muted">Completed</small>
            </div>
        </div>
        <div class="col-6 col-lg-2">
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold text-primary">@Model.TasksCreatedThisWeek</div>
                <small class="text-muted">Created</small>
            </div>
        </div>
        <div class="col-6 col-lg-2">
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold text-danger">@Model.HighRiskTaskCount</div>
                <small class="text-muted">High Risk</small>
            </div>
        </div>
        <div class="col-6 col-lg-2">
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold text-warning">@Model.OverdueTaskCount</div>
                <small class="text-muted">Overdue</small>
            </div>
        </div>
        <div class="col-6 col-lg-2">
            @{
                var healthColor = Model.TeamHealth.Status switch
                {
                    "Healthy" => "text-success",
                    "Attention" => "text-warning",
                    _ => "text-danger"
                };
            }
            <div class="card text-center p-3">
                <div class="fs-3 fw-bold @healthColor">@Model.TeamHealth.Score%</div>
                <small class="text-muted">Team Health</small>
            </div>
        </div>
    </div>

    <!-- Detail Sections -->
    <div class="row g-4">
        <!-- Workforce -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="fas fa-users"></i> Workforce</div>
                <div class="card-body">
                    @if (Model.OverloadedEmployeeCount == 0)
                    {
                        <p class="text-success"><i class="fas fa-check"></i> No overloaded employees</p>
                    }
                    else
                    {
                        <p class="text-warning fw-bold">@Model.OverloadedEmployeeCount overloaded employee(s):</p>
                        <ul class="mb-0">
                            @foreach (var name in Model.OverloadedEmployeeNames)
                            {
                                <li>@name</li>
                            }
                        </ul>
                    }
                </div>
            </div>
        </div>

        <!-- Projects -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="fas fa-project-diagram"></i> Projects</div>
                <div class="card-body">
                    @if (Model.BehindScheduleProjectCount == 0)
                    {
                        <p class="text-success"><i class="fas fa-check"></i> All projects on track</p>
                    }
                    else
                    {
                        <p class="text-danger fw-bold">@Model.BehindScheduleProjectCount project(s) behind schedule:</p>
                        <ul class="mb-0">
                            @foreach (var name in Model.BehindScheduleProjectNames)
                            {
                                <li>@name</li>
                            }
                        </ul>
                    }
                </div>
            </div>
        </div>

        <!-- Security -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="fas fa-shield-alt"></i> Security</div>
                <div class="card-body">
                    @if (Model.AnomaliesDetected == 0)
                    {
                        <p class="text-success"><i class="fas fa-check"></i> No anomalies detected this week</p>
                    }
                    else
                    {
                        <p class="text-danger fw-bold">@Model.AnomaliesDetected anomaly flag(s) detected</p>
                        <a asp-action="Anomalies" asp-route-lookbackHours="168" class="btn btn-sm btn-outline-danger">View Details</a>
                    }
                </div>
            </div>
        </div>

        <!-- Team Health -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="fas fa-heart"></i> Team Health</div>
                <div class="card-body">
                    <p class="fs-4 fw-bold @healthColor">@Model.TeamHealth.Score% — @Model.TeamHealth.Status</p>
                    @if (Model.TeamHealth.RiskFactors.Any())
                    {
                        <ul class="mb-0">
                            @foreach (var factor in Model.TeamHealth.RiskFactors)
                            {
                                <li>@factor</li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-success mb-0"><i class="fas fa-check"></i> No risk factors</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <a asp-action="Index" class="btn btn-outline-secondary mt-3">
        <i class="fas fa-arrow-left"></i> Back to Reports
    </a>
</div>
