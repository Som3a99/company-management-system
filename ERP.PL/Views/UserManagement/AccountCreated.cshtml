@model CreateUserAccountViewModel

@{
    ViewData["Title"] = "Account Created Successfully";
}

<div class="container-fluid px-4">
    <div class="page-header animate-in">
        <div class="container-fluid px-4">
            <div class="d-flex justify-content-between align-items-end flex-wrap gap-3">
            <div>
                <h1>Account Created Successfully</h1>
                <p>User account has been created for @Model.EmployeeName</p>
            </div>
                <a asp-action="EmployeesWithoutAccounts" class="btn btn-primary btn-primary-lg">
                <i class="fas fa-user-plus me-2"></i>Create More Accounts
            </a>
        </div>
    </div>
</div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card animate-in">
                <div class="card-header" style="background: linear-gradient(135deg, var(--success) 0%, #34d399 100%); color: white;">
                    <h5 class="mb-0">
                        <i class="fas fa-check-circle me-2"></i> User Account Created Successfully
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-success d-flex align-items-center">
                        <i class="fas fa-check-circle me-3" style="font-size: 1.5rem;"></i>
                        <div>
                            <strong>Success!</strong> User account has been created for <strong>@Model.EmployeeName</strong>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.GeneratedPassword))
                    {
                        <div class="card border-danger mb-4">
                            <div class="card-header bg-danger text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    CRITICAL: Temporary Password
                                </h6>
                            </div>
                            <div class="card-body">
                                <p class="text-danger fw-bold">
                                    <i class="fas fa-exclamation-circle me-2"></i>
                                    This password will only be shown ONCE. Copy it now!
                                </p>

                                <div class="input-group mb-3">
                                    <input type="text"
                                           class="form-control form-control-lg"
                                           id="generatedPassword"
                                           value="@Model.GeneratedPassword"
                                           readonly
                                           style="font-family: 'Courier New', monospace;">
                                    <button class="btn btn-outline-danger"
                                            type="button"
                                            onclick="copyPassword()">
                                        <i class="fas fa-copy me-1"></i> Copy
                                    </button>
                                </div>

                                <div class="form-check mb-3">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           id="confirmCopied"
                                           onchange="toggleContinue()" />
                                    <label class="form-check-label fw-bold" for="confirmCopied">
                                        <i class="fas fa-check-circle me-1"></i>
                                        I have securely saved this password
                                    </label>
                                </div>

                                <div class="alert alert-warning mb-0">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    <strong>Security Best Practice:</strong> Send this password through secure channels (encrypted email, password manager, or in-person delivery).
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-info-circle me-2"></i>
                            The temporary password has already been displayed and cannot be shown again for security reasons.
                        </div>
                    }

                    <h5 class="mb-3"><i class="fas fa-id-card me-2"></i>Account Details:</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <th width="30%" style="background-color: var(--gray-50);">Employee:</th>
                                    <td>@Model.EmployeeName</td>
                                </tr>
                                <tr>
                                    <th style="background-color: var(--gray-50);">Email/Username:</th>
                                    <td>
                                        <i class="fas fa-envelope text-primary me-2"></i>@Model.EmployeeEmail
                                    </td>
                                </tr>
                                <tr>
                                    <th style="background-color: var(--gray-50);">Position:</th>
                                    <td>@Model.Position</td>
                                </tr>
                                <tr>
                                    <th style="background-color: var(--gray-50);">Department:</th>
                                    <td>
                                        @if (!string.IsNullOrEmpty(Model.DepartmentName))
                                        {
                                            <span class="badge bg-primary">@Model.DepartmentName</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">Unassigned</span>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <th style="background-color: var(--gray-50);">Assigned Roles:</th>
                                    <td>
                                        <div class="d-flex flex-wrap gap-1">
                                            <span class="badge bg-secondary">Employee</span>
                                            @if (Model.IsDepartmentManager)
                                            {
                                                <span class="badge" style="background-color: #f59e0b; color: white;">Department Manager</span>
                                            }
                                            @if (Model.IsProjectManager)
                                            {
                                                <span class="badge" style="background-color: #3b82f6; color: white;">Project Manager</span>
                                            }
                                            <!-- Add other roles if they were selected -->
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info mt-4">
                        <h6><i class="fas fa-key me-2"></i> Next Steps for Employee:</h6>
                        <ol class="mb-0">
                            <li>Provide the temporary password to <strong>@Model.EmployeeName</strong> through secure channels</li>
                            <li>Instruct them to login at the company portal</li>
                            <li>They will be forced to change the password immediately</li>
                            <li>New password must meet security requirements (12+ chars, complexity)</li>
                            <li>They will gain access based on assigned roles</li>
                        </ol>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between">
                        <a asp-action="EmployeesWithoutAccounts"
                           class="btn btn-primary"
                           id="continueBtn"
                           disabled="@(string.IsNullOrEmpty(Model.GeneratedPassword) ? "disabled" : null)">
                            <i class="fas fa-arrow-right me-2"></i> Continue to Create More Accounts
                        </a>
                        <a asp-action="Index" class="btn btn-outline-secondary">
                            <i class="fas fa-users me-2"></i> View All User Accounts
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card animate-in">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-clipboard-check me-2"></i>Account Status
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-column gap-3">
                        <div class="d-flex align-items-center">
                            <div class="me-3" style="color: var(--success);">
                                <i class="fas fa-check-circle" style="font-size: 2rem;"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Account Created</h6>
                                <small class="text-muted">User account is ready for login</small>
                            </div>
                        </div>

                        <div class="d-flex align-items-center">
                            <div class="me-3" style="color: #f59e0b;">
                                <i class="fas fa-key" style="font-size: 2rem;"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Password Setup</h6>
                                <small class="text-muted">User must change password on first login</small>
                            </div>
                        </div>

                        <div class="d-flex align-items-center">
                            <div class="me-3" style="color: var(--accent-main);">
                                <i class="fas fa-user-check" style="font-size: 2rem;"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Access Ready</h6>
                                <small class="text-muted">System access granted with assigned roles</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card animate-in mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-phone-alt me-2"></i>Support Information
                    </h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">If the employee encounters issues during login:</p>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-life-ring text-primary me-2"></i>
                            Contact IT Support: <strong>ext. 5555</strong>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            Email: <strong>support@erp-company.com</strong>
                        </li>
                        <li>
                            <i class="fas fa-clock text-primary me-2"></i>
                            Hours: <strong>8 AM - 6 PM (Mon-Fri)</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyPassword() {
            const passwordField = document.getElementById('generatedPassword');
            navigator.clipboard.writeText(passwordField.value).then(() => {
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check me-1"></i> Copied!';
                btn.classList.remove('btn-outline-danger');
                btn.classList.add('btn-success');
                btn.disabled = true;

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-danger');
                    btn.disabled = false;
                }, 2000);
            });
        }

        function toggleContinue() {
            const checkbox = document.getElementById('confirmCopied');
            const continueBtn = document.getElementById('continueBtn');

            if (checkbox.checked) {
                continueBtn.removeAttribute('disabled');
                continueBtn.classList.remove('btn-secondary');
                continueBtn.classList.add('btn-primary');
            } else {
                continueBtn.setAttribute('disabled', 'disabled');
                continueBtn.classList.remove('btn-primary');
                continueBtn.classList.add('btn-secondary');
            }
        }

        // Initialize button state
        document.addEventListener('DOMContentLoaded', function() {
            toggleContinue();
        });
    </script>
}