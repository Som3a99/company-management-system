@model PagedResult<EmployeeWithoutAccountViewModel>

@{
    ViewData["Title"] = "Employees Without User Accounts";
    var totalEmployees = Model?.TotalCount ?? 0;
    int pageNumber = Model?.PageNumber ?? 1;
    int pageSize = Model?.PageSize ?? 0;
}

<div class="container-fluid px-4">
    <div class="page-header animate-in">
        <div class="container-fluid px-4">
            <div class="d-flex justify-content-between align-items-end flex-wrap gap-3">
            <div>
                <h1>Employees Without User Accounts</h1>
                <p>Create system access accounts for employees without user accounts</p>
            </div>
                <a asp-action="Index" class="btn btn-primary btn-primary-lg">
                <i class="fas fa-users me-2"></i>View All User Accounts
            </a>
        </div>
    </div>
</div>

    @if ((Model?.TotalCount ?? 0) == 0)
    {
        <div class="card animate-in">
            <div class="empty-state">
                <div class="empty-state-icon" style="color: var(--success);">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <h5>All Employees Have User Accounts!</h5>
                <p>Great job! All employees in the system have user accounts created.</p>
                <div class="d-flex gap-2">
                    <a asp-action="Index" class="btn btn-primary">
                        <i class="fas fa-users me-2"></i>View All User Accounts
                    </a>
                    <a asp-controller="Employee" asp-action="Create" class="btn btn-outline-primary">
                        <i class="fas fa-user-plus me-2"></i>Add New Employee
                    </a>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Stats Card -->
        <div class="row g-3 mb-4 animate-in">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); border-radius: var(--radius-md); flex-shrink: 0;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    <circle cx="9" cy="7" r="4" stroke="white" stroke-width="2" />
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <div>
                                <h3 class="mb-0 fw-bold" style="color: #f59e0b;">@totalEmployees</h3>
                                <p class="text-muted mb-0 small">Employees Need User Accounts</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-3 animate-in">
            <div class="card-body p-3">
                <div class="row g-3 align-items-center">
                    <div class="col-lg-12">
                        <div class="alert alert-warning mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Action Required:</strong> @totalEmployees employee(s) need user accounts to access the system.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container animate-in">
            <table class="table table-hover mb-0" id="employeeTable">
                <thead>
                    <tr>
                        <th style="width: 40px;">#</th>
                        <th>Employee Details</th>
                        <th>Position & Department</th>
                        <th>Contact Information</th>
                        <th>Hire Date</th>
                        <th>Current Status</th>
                        <th class="text-center" style="width: 200px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int index = (pageNumber - 1) * pageSize + 1;
                    }
                    @foreach (var employee in Model?.Items ?? Enumerable.Empty<EmployeeWithoutAccountViewModel>())
                    {
                        <tr>
                            <td>
                                <span class="table-code">@(index++)</span>
                            </td>
                            <td>
                                <div>
                                    <strong>@employee.FirstName @employee.LastName</strong>
                                    <br>
                                    <small class="text-muted">@employee.Email</small>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <span class="badge-custom">@employee.Position</span>
                                    <br>
                                    @if (!string.IsNullOrEmpty(employee.DepartmentName))
                                    {
                                        <small class="text-muted">
                                            <i class="fas fa-building me-1"></i>@employee.DepartmentName
                                        </small>
                                    }
                                    else
                                    {
                                        <small class="text-muted">No Department Assigned</small>
                                    }
                                </div>
                            </td>
                            <td>
                                <small class="text-muted">
                                    <i class="fas fa-envelope me-1"></i>@employee.Email
                                </small>
                            </td>
                            <td>
                                <span class="text-muted">@employee.HireDate.ToString("MMM dd, yyyy")</span>
                            </td>
                            <td>
                                <div class="d-flex flex-wrap gap-1">
                                    @if (employee.IsDepartmentManager)
                                    {
                                        <span class="badge" style="background-color: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">
                                            <i class="fas fa-user-tie me-1"></i>Dept Manager
                                        </span>
                                    }
                                    @if (employee.IsProjectManager)
                                    {
                                        <span class="badge" style="background-color: #dbeafe; color: #1e40af; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">
                                            <i class="fas fa-tasks me-1"></i>Project Manager
                                        </span>
                                    }
                                    @if (!employee.IsDepartmentManager && !employee.IsProjectManager)
                                    {
                                        <span class="badge" style="background-color: #f3f4f6; color: #4b5563; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">
                                            <i class="fas fa-user me-1"></i>Employee
                                        </span>
                                    }
                                </div>
                            </td>
                            <td class="text-center">
                                <div class="d-inline-flex gap-2">
                                    <a asp-action="CreateAccount"
                                       asp-route-employeeId="@employee.EmployeeId"
                                       class="btn btn-sm btn-success">
                                        <i class="fas fa-user-plus me-1"></i>Create Account
                                    </a>
                                    <a asp-controller="Employee"
                                       asp-action="Profile"
                                       asp-route-id="@employee.EmployeeId"
                                       class="btn btn-sm btn-outline-secondary"
                                       title="View Employee Profile">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        @if ((Model?.TotalPages ?? 0) > 1)
        {
            var paginationInfo = new PaginationInfoViewModel
            {
                PageNumber = Model?.PageNumber ?? 1,
                PageSize = Model?.PageSize ?? 0,
                TotalCount = Model?.TotalCount ?? 0
            };

            <partial name="_PaginationPartial" model="@paginationInfo"
                     view-data="@(new ViewDataDictionary(ViewData) { { "ItemName", "employees without accounts" } })" />
        }
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on search if there's a search input
            const searchInput = document.querySelector('input[type="search"]');
            if (searchInput) {
                setTimeout(() => searchInput.focus(), 100);
            }
        });
    </script>
}